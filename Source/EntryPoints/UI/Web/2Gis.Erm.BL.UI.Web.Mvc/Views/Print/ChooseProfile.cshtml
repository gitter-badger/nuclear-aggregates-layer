@model ChooseProfileViewModel

@{
    Layout = "../Shared/_DialogLayout.cshtml";
}

@section Title { @BLResources.ChooseLegalPersonProfileDialogTitle }
@section TopBarTitle { @BLResources.ChooseLegalPersonProfileDialogTitle }
@section TopBarMessage { @BLResources.ChooseLegalPersonProfile }

@section PageContent
{
    <script src="/Scripts/Tooltip.js?@SolutionInfo.ProductVersion.Build" type="text/javascript"></script>
    <script src="/Scripts/DoubleGis.UI.GroupOperations.js?@SolutionInfo.ProductVersion.Build" type="text/javascript"></script>
    

    <script type="text/javascript">
        Ext.onReady(function() {

            Ext.getCmp("LegalPersonProfile").on('change', function() {
                var profile = Ext.getCmp("LegalPersonProfile").getValue();
                var profileId = profile ? profile.id : undefined;
                var defaultProfileId = Ext.getDom("DefaultLegalPersonProfileId").value;
                if (profileId != defaultProfileId && profileId != undefined) {
                    Ext.getDom("warning").style.visibility = 'visible';
                } else {
                    Ext.getDom("warning").style.visibility = 'hidden';
                }
            });

            Ext.get("Cancel").on("click", function() { 
                window.close();
            });

            Ext.get("OK").on("click", function() {
                if (Ext.DoubleGis.FormValidator.validate(EntityForm)) {
                    window.returnValue = Ext.getCmp("LegalPersonProfile").getValue().id;
                    window.close();
                }
            });
        });
    </script>
    
    @using (Html.BeginForm(null, null, null, FormMethod.Post, new Dictionary<string, object> {{"id", "EntityForm"}}))
    {
        <table cellspacing="5" cellpadding="5" width="100%" height="100%" style="position: fixed">
            <colgroup>
                <col width="26" />
                <col />
            </colgroup>
            <tbody>
                <tr>
                    <td colspan="2">
                        <div style="height: 30px;" id="Notifications" 
                             onmouseover="AddTooltip(@Model.Message);" 
                             onmouseout="RemoveTooltip();">
                            @Model.Message
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label style="font-weight: bold" for="rdoAssignToUser">@BLResources.PrintWithLegalPersonProfile</label>
                        <table style="table-layout: fixed" cellspacing="0" cellpadding="0" width="100%">
                            <tbody>
                                <tr>
                                    <td>
                                        @Html.TemplateField(m => m.LegalPersonProfile, FieldFlex.lone, new LookupSettings {EntityName = EntityName.LegalPersonProfile, ExtendedInfo = "filterToParent=true", ParentEntityName = EntityName.LegalPerson, ParentIdPattern = "LegalPersonId", ReadOnly = Model.IsCardReadOnly})
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="warning" style="visibility: hidden; color: red">
                            @DoubleGis.Erm.BL.Resources.Server.Properties.Resources.OrderLegalPersonProfileChangeNotification
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="pbDiv">
                            <div id="pbInner">
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        @Html.HiddenFor(m => m.LegalPersonId)
        @Html.HiddenFor(m => m.DefaultLegalPersonProfileId)
    }
}

