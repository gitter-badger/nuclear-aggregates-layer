@using System.Globalization
@model DateTimeOffset

@{
    const string ShortIsoFormat = "yyyy-MM-ddTHH:mm:ss";
    const string FullIsoFormat = "o";
    
    var settings = (CalendarSettings)ViewData["CalendarSettings"];
    var isoFormat = settings.Store == CalendarSettings.StoreMode.Relative 
        ? ShortIsoFormat 
        : FullIsoFormat;
    var dt = Model.ToString(isoFormat, CultureInfo.InvariantCulture);
    var storeMode = settings.Store.ToString().ToLower();
    var displayMode = settings.Display.ToString().ToLower();
    var readOnly = settings.ReadOnly.ToString().ToLower();
    
    var minDate = settings.MinDate.HasValue
                      ? settings.MinDate.Value.ToString(isoFormat, CultureInfo.InvariantCulture)
                      : string.Empty;

    var maxDate = settings.MaxDate.HasValue
                      ? settings.MaxDate.Value.ToString(isoFormat, CultureInfo.InvariantCulture)
                      : string.Empty;
}

@Html.Hidden(string.Empty, dt)
<table id="@Html.IdForModel()_wrapper" class="x-calendar-v2" >
    <tbody>
        <tr>
            <td>
                @Html.TextBox("editor", "", new Dictionary<string, object> { { "class", "inputfields" } })
            </td>
            <td style="width: 36px;">
                <div id="@Html.IdForModel()_btn" class="calendar-button calendar-button-normal"></div>
            </td>
        </tr>
    </tbody>
</table>

<script type="text/javascript">
    new Ext.ux.Calendar2({
        readOnly: @readOnly,
        storeId: '@Html.IdForModel()',
        editorId: '@Html.IdForModel()_editor',
        buttonId: '@Html.IdForModel()_btn',
        mode: {
            store: '@storeMode',
            display: '@displayMode'
        },
        minDate: '@minDate',
        maxDate: '@maxDate'
    });
</script>
